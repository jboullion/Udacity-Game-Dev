<html>
<head>
	<title>Udacity / Google Canvas Tutorial</title>

	<!-- Prevent any caching -->
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />
</head>
<body style="overflow: hidden; padding: 0; margin: 0;">

	<!--
<input type='file' accept='text/plain' onchange='openFile(event)'>
-->
<script type="text/javascript" src="core.js"></script>
<script type="text/javascript" src="spritesheet.js"></script>
<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
<script>


	function xhrGet(reqUri,callback) {
		var xhr = new XMLHttpRequest();

		xhr.open("GET", reqUri, true);
		xhr.onload = callback;

		xhr.send();
	}



var TILEDMapClass = Class.extend({

    // Boolean flag we set once our map atlas
    // has finished loading.
    fullyLoaded: false,

	//-----------------------------------------
    // Load the json file at the url 'map' into
    // memory. This is similar to the requests
    // we've done in the past using
    // XMLHttpRequests.
    load: function (map) {

        // Perform an XMLHttpRequest to grab the
        // JSON file at url 'map'. We've provided
        // the xhrGet function from the optional
        // unit for you to use if you want.
        //
        // Once the XMLHttpRequest loads, set the
        // 'fullyLoaded' flag to true.
        //
        xhrGet( "map.json", function(data) {
			this.fullyLoaded = true;
		});


    }

});

// We define a single global instance of our
// map for the rest of our game code to access.
var gMap = new TILEDMapClass();
gMap.load();






/*
	var canvas = null;
	var ctx = null;
	var gSpriteSheets = new SpriteSheetClass();
	var atlasString = '';
	var atlasJSON = $.getJSON("http://localhost/canvas/robotsTrim.json", function(result){
        atlasString = JSON.stringify(result);
		gSpriteSheets.parseAtlasDefinition(atlasString);
		//console.log(gSpriteSheets);
		//SETUP CANVAS
		setup(600,200);

		//DRAW TO CANVAS
		drawSprite("trimRobot1.png", 0, 0);
		//drawSprite("trimRobot2.png", 200, 0);
		//drawSprite("trimRobot3.png", 400, 0);

    });

	var setup = function(cw, ch) {
	  body = document.body;
	  canvas = document.createElement('canvas');

	  ctx = canvas.getContext('2d');

	  canvas.width = cw;
	  canvas.height = ch;

	  body.appendChild(canvas);

	};
*/

</script>
<!--
<script>

var canvas = null;
var ctx = null;

 var assets = ['https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk00.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk01.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk02.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk03.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk04.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk05.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk06.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk07.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk08.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk09.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk10.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk11.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk12.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk13.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk15.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk16.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk17.png',
			  'https://www.udacity.com/media/js/standalone/libs/gamedev_assets/robowalk/robowalk18.png'
			 ];

var frames = [];

var framesLoaded = 0;
var framesNeeded = assets.length;
var currentFrame = 0;
var fps = 1000/30;

var onImageLoad = function(){
	framesLoaded++;
};

var setup = function() {
    body = document.body;
    canvas = document.createElement('canvas');

    ctx = canvas.getContext('2d');

    canvas.width = 100;
    canvas.height = 100;

    body.appendChild(canvas);

    // Load each image URL from the assets array into the frames array
    // in the correct order.
    // Afterwards, call setInterval to run at a framerate of 30 frames
    // per second, calling the animate function each time.

	assets.map(function(asset, index){
 		frames[index] = new Image();
		frames[index].onload = onImageLoad;
		frames[index].src = asset;

   });

	setInterval( animate, fps);
};

var animate = function(){

	// Try your code with this call to clearRect commented out
    // and uncommented to see what happens!
    ctx.clearRect(0,0,canvas.width, canvas.height);

    // Draw each frame in order, looping back around to the
    // beginning of the animation once you reach the end.
    // Draw each frame at a position of (0,0) on the canvas.
	if(framesLoaded == framesNeeded){
		if(frames[currentFrame] instanceof HTMLImageElement){
			ctx.drawImage(frames[currentFrame],0,0);
		}

		//currentFrame = currentFrame >= framesNeeded - 1? 0:currentFrame+1;
		currentFrame = (currentFrame + 1) % frames.length;
	}

};

// We'll call your setup function in our test code, so
// don't call it in your code.
setup();
</script>
-->
</body>
</html>
